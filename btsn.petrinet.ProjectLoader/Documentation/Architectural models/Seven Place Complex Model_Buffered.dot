digraph BTSN_7_Place_Complex_Buffered {
    rankdir=LR;
    node [fontname="Arial"];
    edge [fontname="Arial"];
    
    // Input Transitions (blue rectangles) - WITH BUFFER SPECIFICATIONS
    node [shape=rect, style=filled, fillcolor=lightblue, width=1.4, height=0.7];
    
    T_in_1 [label="T_in_1\nEntry [buf:30]", buffer=30];
    T_in_2 [label="T_in_2\nAuth Sync [buf:25]", buffer=25];
    T_in_3 [label="T_in_3\nUser Sync [buf:25]", buffer=25];
    T_in_4 [label="T_in_4\nValidation\n3-way sync [buf:150]", buffer=150];
    T_in_10 [label="T_in_10\nFinal\nSync [buf:25]", buffer=25];
    
    // Places (green circles) - Services with 1:1 relationships
    node [shape=circle, style=filled, fillcolor=lightgreen, width=1.1, height=1.1];
    
    P1 [label="P1\nRequest\nReceiver"];
    P2 [label="P2\nAuth\nService"];
    P3 [label="P3\nUser\nLookup"];
    P4 [label="P4\nBusiness\nValidator"];
    P10 [label="P10\nCompletion\nHandler"];
    
    // Output Transitions (orange rectangles) - Forking only
    node [shape=rect, style=filled, fillcolor=orange, width=1.4, height=0.7];
    
    T_out_1 [label="T_out_1\nFork 3-way"];
    T_out_2 [label="T_out_2\nAuth Result"];
    T_out_3 [label="T_out_3\nUser Result"];
    T_out_4 [label="T_out_4\nValidation\nResult"];
    T_out_10 [label="T_out_10\nComplete"];
    
    // External nodes
    node [shape=doublecircle, fillcolor=yellow, width=0.8, height=0.8];
    START [label="START"];
    END [label="END"];
    
    // === IMMUTABLE BUILDING BLOCK FLOWS ===
    // Each place has exactly one T_in and one T_out
    
    // Building block 1
    T_in_1 -> P1;
    P1 -> T_out_1;
    
    // Building block 2 
    T_in_2 -> P2;
    P2 -> T_out_2;
    
    // Building block 3
    T_in_3 -> P3;
    P3 -> T_out_3;
    
    // Building block 4
    T_in_4 -> P4;
    P4 -> T_out_4;
    
    // Building block 5 (P10 - Completion Handler)
    T_in_10 -> P10;
    P10 -> T_out_10;
    
    // === COORDINATION FLOWS ===
    
    // Entry point
    START -> T_in_1 [label="request"];
    
    // Initial 3-way fork
    T_out_1 -> T_in_2 [label="auth\nrequest", color=red, style=bold];
    T_out_1 -> T_in_3 [label="user\nlookup", color=red, style=bold];
    T_out_1 -> T_in_4 [label="validation\nrequest", color=green, style="bold,dashed"]; // Feedforward bypass
    
    // 3-way synchronization at validation
    T_out_2 -> T_in_4 [label="auth\nresult", color=blue, style=bold];
    T_out_3 -> T_in_4 [label="user\ndata", color=blue, style=bold];
    // T_out_1 already connected above as feedforward
    
    // Validation to completion
    T_out_4 -> T_in_10 [label="validation\ncomplete", color=blue];
    
    // Completion
    T_out_10 -> END [label="finished"];
    
    // Layout hints for better organization
    {rank=same; T_in_2; T_in_3; T_in_4}
    {rank=same; P2; P3; P4}
    {rank=same; T_out_2; T_out_3; T_out_4}
    
    // Buffer Sizing Strategy Description
    label="BTSN 5-Place Streamlined Workflow with Strategic Buffer Sizing\n\n" +
          "Buffer Sizing Strategy (Per Mathematical Model):\n" +
          "• Entry Point (T_in_1): 30 tokens - slightly higher for system entry\n" +
          "• Simple Sync (≤1 source): 25 tokens - standard capacity\n" +
          "• 3-way Sync: 150 tokens - large capacity for complex coordination\n\n" +
          "Critical Synchronization Points:\n" +
          "• T_in_4: 3-way sync [buf:150] - auth + user + feedforward validation\n" +
          "• T_in_10: simple sync [buf:25] - direct validation result\n\n" +
          "Streamlined Architecture Pattern:\n" +
          "• Initial 3-way fork (T_out_1 → T_in_2,3,4)\n" +
          "• Feedforward bypass (green dashed: fast validation path)\n" +
          "• Complex synchronization with different arrival times\n" +
          "• Direct linear flow: validation → completion\n" +
          "• Eliminated all parallel processing complexity\n" +
          "• End-to-end workflow with 5 service stages\n\n" +
          "Removed Services: P5 (Data Processor), P6 (Approval), P7 (Notification), P8 (Audit), P9 (Archive)\n\n" +
          "Expected Behavior:\n" +
          "• High buffer utilization at T_in_4 (3-way sync)\n" +
          "• Low utilization at all other synchronization points\n" +
          "• Maximum simplicity with essential services only\n" +
          "• Fastest completion due to eliminated processing stages\n" +
          "• Pure coordination workflow: request → auth/user/validation → completion";
    
    fontsize=8;
}