digraph Emergency_Department_Patient_Flow {
    rankdir=LR;
    node [fontname="Arial"];
    edge [fontname="Arial"];
    
    // External Entry and Exit Points
    node [shape=doublecircle, fillcolor=yellow, style=filled, width=1.0, height=1.0];
    PATIENT_ARRIVAL [label="PATIENT\nARRIVAL"];
    PATIENT_DISCHARGE [label="PATIENT\nDISCHARGE"];
    
    // Critical Care Path - High Priority Buffer
    node [shape=rect, style=filled, fillcolor=lightblue, width=1.5, height=0.8];
    T_in_Triage [label="T_in_Triage\nInitial Assessment\n[buf:50]", buffer=50];
    
    // Triage Assessment Place
    node [shape=circle, style=filled, fillcolor=lightgreen, width=1.2, height=1.2];
    P_Triage [label="P_Triage\nVital Signs\nPriority Scoring"];
    
    // Distribution to Parallel Diagnostics
    node [shape=rect, style=filled, fillcolor=orange, width=1.5, height=0.8];
    T_out_Triage [label="T_out_Triage\nDiagnostic\nCoordinator"];
    
    // Parallel Diagnostic Input Transitions - Optimized Buffers
    node [shape=rect, style=filled, fillcolor=lightblue, width=1.4, height=0.8];
    T_in_Radiology [label="T_in_Radiology\nImaging Queue\n[buf:30]", buffer=30];
    T_in_Laboratory [label="T_in_Laboratory\nLab Queue\n[buf:25]", buffer=25];
    T_in_Cardiology [label="T_in_Cardiology\nECG Queue\n[buf:20]", buffer=20];
    
    // Diagnostic Processing Places
    node [shape=circle, style=filled, fillcolor=lightgreen, width=1.2, height=1.2];
    P_Radiology [label="P_Radiology\nCT/X-Ray\nProcessing"];
    P_Laboratory [label="P_Laboratory\nBlood Analysis\nBiomarkers"];
    P_Cardiology [label="P_Cardiology\nECG Analysis\nCardiac Assessment"];
    
    // Diagnostic Output Transitions
    node [shape=rect, style=filled, fillcolor=orange, width=1.4, height=0.8];
    T_out_Radiology [label="T_out_Radiology\nImaging Results"];
    T_out_Laboratory [label="T_out_Laboratory\nLab Results"];
    T_out_Cardiology [label="T_out_Cardiology\nCardiac Results"];
    
    // Critical Synchronization Point - Large Buffer for Safety
    node [shape=rect, style=filled, fillcolor=red, width=1.6, height=0.9];
    T_in_Diagnosis [label="T_in_Diagnosis\nClinical Decision\nSynchronization\n[buf:100]", buffer=100];
    
    // Clinical Decision Making Place
    node [shape=circle, style=filled, fillcolor=lightcoral, width=1.3, height=1.3];
    P_Diagnosis [label="P_Diagnosis\nPhysician Review\nTreatment Planning"];
    
    // Treatment Coordination
    node [shape=rect, style=filled, fillcolor=orange, width=1.5, height=0.8];
    T_out_Diagnosis [label="T_out_Diagnosis\nTreatment\nCoordinator"];
    
    // Treatment Input Transition
    node [shape=rect, style=filled, fillcolor=lightblue, width=1.4, height=0.8];
    T_in_Treatment [label="T_in_Treatment\nTherapy Queue\n[buf:40]", buffer=40];
    
    // Treatment Processing Place
    node [shape=circle, style=filled, fillcolor=lightgreen, width=1.2, height=1.2];
    P_Treatment [label="P_Treatment\nMedical Intervention\nMonitoring"];
    
    // Final Discharge Coordination
    node [shape=rect, style=filled, fillcolor=orange, width=1.4, height=0.8];
    T_out_Treatment [label="T_out_Treatment\nDischarge\nCoordinator"];
    
    // === PATIENT FLOW CONNECTIONS ===
    
    // Entry Path
    PATIENT_ARRIVAL -> T_in_Triage [label="patient\narrival"];
    T_in_Triage -> P_Triage [label="triage\ntoken"];
    P_Triage -> T_out_Triage [label="assessed\npatient"];
    
    // Fork to Parallel Diagnostics
    T_out_Triage -> T_in_Radiology [label="imaging\norder"];
    T_out_Triage -> T_in_Laboratory [label="lab\norder"];
    T_out_Triage -> T_in_Cardiology [label="cardiac\norder"];
    
    // Parallel Diagnostic Processing
    T_in_Radiology -> P_Radiology [label="imaging\nrequest"];
    P_Radiology -> T_out_Radiology [label="imaging\nresults"];
    
    T_in_Laboratory -> P_Laboratory [label="lab\nrequest"];
    P_Laboratory -> T_out_Laboratory [label="lab\nresults"];
    
    T_in_Cardiology -> P_Cardiology [label="cardiac\nrequest"];
    P_Cardiology -> T_out_Cardiology [label="cardiac\nresults"];
    
    // Synchronization for Clinical Decision
    T_out_Radiology -> T_in_Diagnosis [label="imaging\ndata"];
    T_out_Laboratory -> T_in_Diagnosis [label="lab\ndata"];
    T_out_Cardiology -> T_in_Diagnosis [label="cardiac\ndata"];
    
    // Treatment Path
    T_in_Diagnosis -> P_Diagnosis [label="complete\ndiagnostic"];
    P_Diagnosis -> T_out_Diagnosis [label="treatment\nplan"];
    T_out_Diagnosis -> T_in_Treatment [label="therapy\norder"];
    T_in_Treatment -> P_Treatment [label="treatment\ntoken"];
    P_Treatment -> T_out_Treatment [label="treated\npatient"];
    
    // Final Discharge
    T_out_Treatment -> PATIENT_DISCHARGE [label="discharge\nready"];
    
    // Architecture Description
    label="Emergency Department Patient Flow - BTSN Architecture\n\n" +
          "CRITICAL BTSN FEATURES DEMONSTRATED:\n" +
          "• Correlation-Based Patient Tracking: Single patient ID maintained across all forks\n" +
          "• Parallel Diagnostic Processing: Radiology, Lab, Cardiology run simultaneously\n" +
          "• Safety-Critical Synchronization: All results required before treatment decisions\n" +
          "• Adaptive Buffer Sizing: Critical paths get larger buffers (Diagnosis=100)\n" +
          "• Context-Accumulating Tokens: Patient data grows richer at each stage\n" +
          "• Formal Timing Guarantees: Mathematical bounds on emergency response times\n" +
          "• Resource Optimization: Intelligent queue management prevents bottlenecks\n\n" +
          "PATIENT SAFETY: No treatment decisions without complete diagnostic information\n" +
          "EFFICIENCY: Parallel processing minimizes time to diagnosis\n" +
          "COMPLIANCE: Complete audit trail for medical-legal requirements";
    
    fontsize=10;
}